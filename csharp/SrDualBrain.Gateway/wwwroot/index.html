<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>SrDualBrain Gateway</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
	  <body>
	    <header class="topbar">
	      <div class="brand">
	        <div class="brand__title">SrDualBrain</div>
	        <div class="brand__subtitle">C# REST Gateway → Python Engine</div>
	      </div>
	      <div class="topbar__right">
	        <button class="btn btn--ghost" id="btnPopMetrics" type="button">Pop out metrics</button>
	        <div class="status" id="status">
	          <span class="pill pill--muted">connecting…</span>
	        </div>
	      </div>
	    </header>

    <main class="layout">
      <section class="card chat">
        <div class="card__header">
          <div class="card__title">Chat</div>
	          <div class="card__actions">
	            <button class="btn btn--ghost" id="btnClear">Clear</button>
	            <button class="btn btn--danger" id="btnReset">Reset session</button>
	            <button class="btn btn--danger" id="btnRestartEngine">Restart engine</button>
	          </div>
	        </div>

        <div class="chat__log" id="chatLog" aria-live="polite"></div>

        <form class="chat__composer" id="composer">
          <textarea
            id="question"
            rows="2"
            placeholder="Type a message… (Enter to send, Shift+Enter for newline)"
            spellcheck="false"
          ></textarea>
          <button class="btn btn--primary" id="btnSend" type="submit">Send</button>
        </form>
      </section>

      <aside class="side">
        <section class="card controls">
          <div class="card__header">
            <div class="card__title">Controls</div>
          </div>
          <div class="grid">
            <label class="field">
              <span class="field__label">Session</span>
              <input id="sessionId" type="text" value="demo" />
            </label>

            <label class="field">
              <span class="field__label">Leading brain</span>
              <select id="leadingBrain">
                <option value="auto">auto</option>
                <option value="left">left</option>
                <option value="right">right</option>
              </select>
            </label>

            <label class="field">
              <span class="field__label">Provider (optional)</span>
              <select id="llmProvider">
                <option value="">(use server default)</option>
                <option value="openai">openai</option>
                <option value="anthropic">anthropic</option>
                <option value="google">google</option>
                <option value="mistral">mistral</option>
                <option value="xai">xai</option>
                <option value="huggingface">huggingface</option>
              </select>
            </label>

            <label class="field">
              <span class="field__label">Model (optional)</span>
              <input id="llmModel" type="text" placeholder="e.g. gpt-4o-mini" />
            </label>

            <label class="field">
              <span class="field__label">Max output tokens (optional)</span>
              <input id="llmMaxOutputTokens" type="number" min="64" step="1" placeholder="1024" />
            </label>

            <label class="field">
              <span class="field__label">Executive mode</span>
              <select id="executiveMode">
                <option value="off">off</option>
                <option value="observe" selected>observe (memo only)</option>
                <option value="assist">assist (mix-in + memo)</option>
                <option value="polish">polish (may reset stream)</option>
              </select>
            </label>

            <label class="field">
              <span class="field__label">Executive observer (experiment)</span>
              <select id="executiveObserverMode">
                <option value="off" selected>off</option>
                <option value="director">director (pre-turn steering)</option>
                <option value="metrics">metrics (post-turn feedback)</option>
                <option value="both">both (director + feedback)</option>
              </select>
            </label>

            <label class="field">
              <span class="field__label">System2 mode (reasoning)</span>
              <select id="system2Mode">
                <option value="auto" selected>auto</option>
                <option value="off">off</option>
                <option value="on">on (right brain = critic)</option>
              </select>
            </label>
          </div>

          <div class="blob">
            <div class="blob__row">
              <label class="field blob__file">
                <span class="field__label">Image (optional)</span>
                <input id="blobFile" type="file" accept="image/*" />
              </label>
              <button class="btn btn--ghost" id="btnUploadBlob" type="button">Upload</button>
            </div>
            <div class="chips" id="blobChips"></div>
          </div>

          <div class="checks">
            <label class="check">
              <input id="useStreaming" type="checkbox" checked />
              <span>Stream answer (SSE)</span>
            </label>
            <label class="check">
              <input id="returnExecutive" type="checkbox" checked />
              <span>Return executive memo (out-of-band)</span>
            </label>
            <label class="check">
              <input id="returnTelemetry" type="checkbox" />
              <span>Return telemetry</span>
            </label>
            <label class="check">
              <input id="returnDialogueFlow" type="checkbox" />
              <span>Return dialogue flow</span>
            </label>
            <label class="check">
              <input id="traceInline" type="checkbox" />
              <span>Inline trace (slower)</span>
            </label>
          </div>

          <div class="hint">
            API keys are read from server environment variables (never sent from browser).
          </div>
        </section>

        <section class="card metrics">
          <div class="card__header">
            <div class="card__title">Metrics</div>
            <div class="card__subtitle" id="metricsSubtitle">—</div>
          </div>
          <div class="metrics__grid" id="metricsGrid">
            <div class="metric">
              <div class="metric__k">coherence</div>
              <div class="metric__v" id="mCoherence">—</div>
            </div>
            <div class="metric">
              <div class="metric__k">tension</div>
              <div class="metric__v" id="mTension">—</div>
            </div>
            <div class="metric">
              <div class="metric__k">routing</div>
              <div class="metric__v" id="mRouting">—</div>
            </div>
            <div class="metric">
              <div class="metric__k">action</div>
              <div class="metric__v" id="mAction">—</div>
            </div>
            <div class="metric">
              <div class="metric__k">temperature</div>
              <div class="metric__v" id="mTemp">—</div>
            </div>
            <div class="metric">
              <div class="metric__k">latency</div>
              <div class="metric__v" id="mLatency">—</div>
            </div>
            <div class="metric">
              <div class="metric__k">system2</div>
              <div class="metric__v" id="mSystem2">—</div>
            </div>
            <div class="metric">
              <div class="metric__k">meta action</div>
              <div class="metric__v" id="mMetaAction">—</div>
            </div>
            <div class="metric">
              <div class="metric__k">meta coverage</div>
              <div class="metric__v" id="mMetaCoverage">—</div>
            </div>
            <div class="metric">
              <div class="metric__k">meta flags</div>
              <div class="metric__v" id="mMetaFlags">—</div>
            </div>
          </div>

	          <div class="card__actions actions-row">
	            <button class="btn btn--ghost" id="btnExportBundle" type="button">Export bundle</button>
	            <button class="btn btn--ghost" id="btnExportTrace" type="button">Export trace</button>
	            <button class="btn btn--ghost" id="btnExportTelemetry" type="button">Export telemetry</button>
	            <button class="btn btn--ghost" id="btnExportDialogueFlow" type="button">Export dialogue</button>
	            <button class="btn btn--ghost" id="btnExportBrainHistory" type="button">Export brain history</button>
	            <button class="btn btn--ghost" id="btnExportModuleHistory" type="button">Export module history</button>
	            <button class="btn btn--ghost" id="btnExportChat" type="button">Export chat</button>
	          </div>

          <div class="chips" id="activeModules"></div>

          <details class="details" open>
            <summary>Architecture path</summary>
            <div class="path" id="modulePath"></div>
          </details>

          <details class="details" open>
            <summary>Brain activity</summary>
            <div class="brain" id="brainActivity"></div>
            <div class="bh" id="brainHistory"></div>
          </details>

          <details class="details" open>
            <summary>Module activity</summary>
            <div class="mh" id="moduleHistory"></div>
          </details>

          <details class="details">
            <summary>Executive memo</summary>
            <pre class="json" id="executiveMemo">—</pre>
          </details>

          <details class="details">
            <summary>Executive observer memo</summary>
            <pre class="json" id="executiveObserverMemo">—</pre>
          </details>

          <details class="details">
            <summary>Telemetry (raw)</summary>
            <pre class="json" id="telemetryRaw">{}</pre>
          </details>

          <details class="details">
            <summary>Dialogue flow (raw)</summary>
            <pre class="json" id="dialogueFlowRaw">{}</pre>
          </details>
        </section>
      </aside>
    </main>

    <script src="/app.js"></script>
  </body>
</html>
